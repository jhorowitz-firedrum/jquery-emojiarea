/*! jquery.emojiarea.js | https://github.com/diy/jquery-emojiarea | Apache License (v2) */
(function(d,g,e){var t=["p","div","pre","form"],u=[8,9,17,18,37,38,39,40,91,46];d.emojiarea={path:"",icons:{},defaults:{button:null,buttonLabel:"Emojis",buttonPosition:"after"},assetsPath:"",iconSize:25};var r=":joy: :kissing_heart: :heart: :heart_eyes: :blush: :grin: :+1: :relaxed: :pensive: :smile: :sob: :kiss: :unamused: :flushed: :stuck_out_tongue_winking_eye: :see_no_evil: :wink: :smiley: :cry: :stuck_out_tongue_closed_eyes: :scream: :rage: :smirk: :disappointed: :sweat_smile: :kissing_closed_eyes: :speak_no_evil: :relieved: :grinning: :yum: :laughing: :ok_hand: :neutral_face: :confused:".split(" ");
d.fn.emojiarea=function(a){a=d.extend({},d.emojiarea.defaults,a);return this.each(function(){var b=d(this);if("contentEditable"in e.body&&!1!==a.wysiwyg){var c=getGuid();new k(b,c,d.extend({},a))}else c=getGuid(),new q(b,c,a);b.attr({"data-emojiable":"converted","data-id":c,"data-type":"original-input"})})};var f={};f.restoreSelection=function(){if(g.getSelection)return function(a){var b=g.getSelection();b.removeAllRanges();for(var c=0,d=a.length;c<d;++c)b.addRange(a[c])};if(e.selection&&e.selection.createRange)return function(a){a&&
a.select()}}();f.saveSelection=function(){if(g.getSelection)return function(){var a=g.getSelection(),b=[];if(a.rangeCount)for(var c=0,d=a.rangeCount;c<d;++c)b.push(a.getRangeAt(c));return b};if(e.selection&&e.selection.createRange)return function(){var a=e.selection;return"none"!==a.type.toLowerCase()?a.createRange():null}}();f.replaceSelection=function(){if(g.getSelection)return function(a){var b,c=g.getSelection(),d="string"===typeof a?e.createTextNode(a):a;c.getRangeAt&&c.rangeCount&&(b=c.getRangeAt(0),
b.deleteContents(),b.insertNode(d),b.setStart(d,0),g.setTimeout(function(){b=e.createRange();b.setStartAfter(d);b.collapse(!0);c.removeAllRanges();c.addRange(b)},0))};if(e.selection&&e.selection.createRange)return function(a){var b=e.selection.createRange();"string"===typeof a?b.text=a:b.pasteHTML(a.outerHTML)}}();f.insertAtCursor=function(a,b){a=" "+a;var c=b.value,d;"undefined"!=typeof b.selectionStart&&"undefined"!=typeof b.selectionEnd?(d=b.selectionStart,b.value=c.substring(0,d)+a+c.substring(b.selectionEnd),
b.selectionStart=b.selectionEnd=d+a.length):"undefined"!=typeof e.selection&&"undefined"!=typeof e.selection.createRange&&(b.focus(),c=e.selection.createRange(),c.text=a,c.select())};f.extend=function(a,b){"undefined"!==typeof a&&a||(a={});if("object"===typeof b)for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a};f.escapeRegex=function(a){return(a+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")};f.htmlEntities=function(a){return String(a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,
"&gt;").replace(/"/g,"&quot;")};f.emojiInserted=function(a,b){ConfigStorage.get("emojis_recent",function(b){b=b||r||[];var c=b.indexOf(a);if(!c)return!1;-1!=c&&b.splice(c,1);b.unshift(a);42<b.length&&(b=b.slice(42));ConfigStorage.set({emojis_recent:b})})};var n=function(){};n.prototype.setup=function(){var a=this;this.$editor.on("focus",function(){a.hasFocus=!0});this.$editor.on("blur",function(){a.hasFocus=!1});a.emojiMenu=new h(a);this.setupButton()};n.prototype.setupButton=function(){var a=this,
b=d("[data-id="+this.id+"][data-type=picker]");b.on("click",function(b){a.emojiMenu.show(a)});this.$button=b;this.$dontHideOnClick="emoji-picker"};n.createIcon=function(a,b){var c=a[0],m=a[3],l=d.emojiarea.assetsPath+"/blank.gif",p=b&&Config.Mobile?26:d.emojiarea.iconSize,e=-(p*a[2]),v=-(p*a[1]),w=Config.EmojiCategorySpritesheetDimens[c][1]*p,g=Config.EmojiCategorySpritesheetDimens[c][0]*p,c="display:inline-block;"+("width:"+p+"px;")+("height:"+p+"px;")+("background:url('"+(d.emojiarea.assetsPath+
"/emoji_spritesheet_!.png").replace("!",c)+"') "+e+"px "+v+"px no-repeat;");return'<img src="'+l+'" class="img" style="'+(c+("background-size:"+w+"px "+g+"px;"))+'" alt="'+f.htmlEntities(m)+'">'};d.emojiarea.createIcon=n.createIcon;var q=function(a,b,c){this.options=c;this.$editor=this.$textarea=a;this.id=b;this.setup()};q.prototype.insert=function(a){d.emojiarea.icons.hasOwnProperty(a)&&(f.insertAtCursor(a,this.$textarea[0]),f.emojiInserted(a,this.menu),this.$textarea.trigger("change"))};q.prototype.val=
function(){return"\n"==this.$textarea?"":this.$textarea.val()};f.extend(q.prototype,n.prototype);var k=function(a,b,c){var m=this;this.options=c||{};"unicode"===d(a).attr("data-emoji-input")?this.options.inputMethod="unicode":this.options.inputMethod="image";this.id=b;this.$textarea=a;this.emojiPopup=c.emojiPopup;this.$editor=d("<div>").addClass("emoji-wysiwyg-editor").addClass(d(a)[0].className);this.$editor.data("self",this);a.attr("maxlength")&&this.$editor.attr("maxlength",a.attr("maxlength"));
c=this.emojiPopup.unicodeToImage(a.val());this.$editor.html(c);this.$editor.attr({"data-id":b,"data-type":"input",placeholder:a.attr("placeholder"),contenteditable:"true"});c="blur change";this.options.norealTime||(c+=" keyup");this.$editor.on(c,function(a){return m.onChange.apply(m,[a])});this.$editor.on("mousedown focus",function(){e.execCommand("enableObjectResizing",!1,!1)});this.$editor.on("blur",function(){e.execCommand("enableObjectResizing",!0,!0)});var l=this.$editor;this.$editor.on("change keydown keyup resize scroll",
function(a){!(-1!=u.indexOf(a.which)||(a.ctrlKey||a.metaKey)&&65==a.which||(a.ctrlKey||a.metaKey)&&67==a.which)&&l.text().length+l.find("img").length>=l.attr("maxlength")&&a.preventDefault();m.updateBodyPadding(l)});this.options.onPaste&&(m=this,this.$editor.on("paste",function(a){a.preventDefault();(a.originalEvent||a).clipboardData?(a=(a.originalEvent||a).clipboardData.getData("text/plain"),a=m.options.onPaste(a),e.execCommand("insertText",!1,a)):g.clipboardData&&(a=g.clipboardData.getData("Text"),
a=m.options.onPaste(a),e.selection.createRange().pasteHTML(a));l.scrollTop(l[0].scrollHeight)}));a.after("<i class='emoji-picker-icon emoji-picker "+this.options.popupButtonClasses+"' data-id='"+b+"' data-type='picker'></i>");a.hide().after(this.$editor);this.setup();d(e.body).on("mousedown",function(){m.hasFocus&&(m.selection=f.saveSelection())})};k.prototype.updateBodyPadding=function(a){var b=d("[data-id="+this.id+"][data-type=picker]");d(a).hasScrollbar()?(b.hasClass("parent-has-scroll")||b.addClass("parent-has-scroll"),
d(a).hasClass("parent-has-scroll")||d(a).addClass("parent-has-scroll")):(b.hasClass("parent-has-scroll")&&b.removeClass("parent-has-scroll"),d(a).hasClass("parent-has-scroll")&&d(a).removeClass("parent-has-scroll"))};k.prototype.onChange=function(a){this.$textarea.val(this.val()).trigger("change")};k.prototype.insert=function(a){var b="";"unicode"==this.options.inputMethod?b=this.emojiPopup.colonToUnicode(a):(b=d(n.createIcon(d.emojiarea.icons[a])),b[0].attachEvent&&b[0].attachEvent("onresizestart",
function(a){a.returnValue=!1},!1),b=b[0]);this.$editor.trigger("focus");this.selection&&f.restoreSelection(this.selection);try{f.replaceSelection(b)}catch(c){}f.emojiInserted(a,this.menu);this.onChange()};k.prototype.val=function(){for(var a=[],b=[],c=this.emojiPopup,d=function(){a.push(b.join(""));b=[]},l=function(a){if(3===a.nodeType)b.push(a.nodeValue);else if(1===a.nodeType){var c=a.tagName.toLowerCase(),e=-1!==t.indexOf(c);e&&b.length&&d();if("img"===c)(e=a.getAttribute("alt")||"")&&b.push(e);
else{"br"===c&&d();a=a.childNodes;for(c=0;c<a.length;c++)l(a[c]);e&&b.length&&d()}}},e=this.$editor[0].childNodes,f=0;f<e.length;f++)l(e[f]);b.length&&d();e=a.join("\n");return c.colonToUnicode(e)};f.extend(k.prototype,n.prototype);jQuery.fn.hasScrollbar=function(){var a=this.get(0).scrollHeight;return this.outerHeight()<a?!0:!1};var h=function(a){var b=this;b.id=a.id;var c=d(e.body),f=d(g);this.visible=!1;this.emojiarea=a;h.menuZIndex=5E3;this.$menu=d("<div>");this.$menu.addClass("emoji-menu");this.$menu.attr("data-id",
b.id);this.$menu.attr("data-type","menu");this.$menu.hide();this.$itemsTailWrap=d('<div class="emoji-items-wrap1"></div>').appendTo(this.$menu);this.$categoryTabs=d('<table class="emoji-menu-tabs"><tr><td><a class="emoji-menu-tab icon-recent" ></a></td><td><a class="emoji-menu-tab icon-smile" ></a></td><td><a class="emoji-menu-tab icon-flower"></a></td><td><a class="emoji-menu-tab icon-bell"></a></td><td><a class="emoji-menu-tab icon-car"></a></td><td><a class="emoji-menu-tab icon-grid"></a></td></tr></table>').appendTo(this.$itemsTailWrap);
this.$itemsWrap=d('<div class="emoji-items-wrap nano mobile_scrollable_wrap"></div>').appendTo(this.$itemsTailWrap);this.$items=d('<div class="emoji-items nano-content">').appendTo(this.$itemsWrap);c.append(this.$menu);Config.Mobile||this.$itemsWrap.nanoScroller({preventPageScrolling:!0,tabIndex:-1});c.on("keydown",function(a){27!==a.keyCode&&9!==a.keyCode||b.hide()});c.on("message_send",function(a){b.hide()});c.on("mouseup",function(a){a=a.originalEvent||a;a=a.originalTarget||a.target||g;if(!d(a).hasClass(b.emojiarea.$dontHideOnClick)){for(;a&&
a!=g;)if(a=a.parentNode,a==b.$menu[0]||b.emojiarea&&a==b.emojiarea.$button[0])return;b.hide()}});f.on("resize",function(){b.visible&&b.reposition()});this.$menu.on("mouseup","a",function(a){a.stopPropagation();return!1});this.$menu.on("click","a",function(a){b.emojiarea.updateBodyPadding(b.emojiarea.$editor);if(d(this).hasClass("emoji-menu-tab"))return b.getTabIndex(this)!==b.currentCategory&&b.selectCategory(b.getTabIndex(this)),!1;var c=d(".label",d(this)).text();g.setTimeout(function(){b.onItemSelected(c);
(a.ctrlKey||a.metaKey)&&b.hide()},0);a.stopPropagation();return!1});this.selectCategory(0)};h.prototype.getTabIndex=function(a){return this.$categoryTabs.find(".emoji-menu-tab").index(a)};h.prototype.selectCategory=function(a){this.$categoryTabs.find(".emoji-menu-tab").each(function(b){this.className=b===a?this.className+"-selected":this.className.replace("-selected","")});this.currentCategory=a;this.load(a);Config.Mobile||this.$itemsWrap.nanoScroller({scroll:"top"})};h.prototype.onItemSelected=function(a){this.emojiarea.$editor.text().length+
this.emojiarea.$editor.find("img").length>=this.emojiarea.$editor.attr("maxlength")||this.emojiarea.insert(a)};h.prototype.load=function(a){var b=[],c=d.emojiarea.icons,e=d.emojiarea.assetsPath,g=this;e.length&&"/"!==e.charAt(e.length-1)&&(e+="/");var h=function(){g.$items.html(b.join(""));Config.Mobile||setTimeout(function(){g.$itemsWrap.nanoScroller()},100)};if(0<a){for(var k in c)c.hasOwnProperty(k)&&c[k][0]===a-1&&b.push('<a href="javascript:void(0)" title="'+f.htmlEntities(k)+'">'+n.createIcon(c[k],
!0)+'<span class="label">'+f.htmlEntities(k)+"</span></a>");h()}else ConfigStorage.get("emojis_recent",function(a){a=a||r||[];var d,e;for(e=0;e<a.length;e++)d=a[e],c[d]&&b.push('<a href="javascript:void(0)" title="'+f.htmlEntities(d)+'">'+n.createIcon(c[d],!0)+'<span class="label">'+f.htmlEntities(d)+"</span></a>");h()})};h.prototype.reposition=function(){this.tether||(this.tether=new Tether({element:'[data-id="'+this.id+'"][data-type="menu"]',target:'[data-id="'+this.id+'"][data-type="picker"]',
attachment:"left center",targetAttachment:"bottom left",offset:"0 12px",constraints:[{to:"html",pin:!0}]}))};h.prototype.hide=function(a){this.visible=!1;this.$menu.hide("fast")};h.prototype.show=function(a){if(this.visible)return this.hide();this.reposition();d(this.$menu).css("z-index",++h.menuZIndex);this.$menu.show("fast");this.currentCategory||this.load(0);this.visible=!0}})(jQuery,window,document);
